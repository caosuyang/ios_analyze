# 性能优化-EXC_BAD_ACCESS

## EXC_BAD_ACCESS

1. 访问未分配的内存：XNU 会报 EXC_BAD_ACCESS 错误，信号为 SIGSEGV Signal #11。
2. 野指针：指针指向一个已删除的对象访问内存区域时，会出现野指针崩溃。野指针问题是需要我们重点关注的，因为它是导致 App 崩溃的最常见，也是最难定位的一种情况。

注意：“访问未分配的内存”问题可以通过崩溃信息获取到，在收集崩溃信息时如果发现是这两类，我们就可以把内存分配的记录同时传过来进行分析，对于不合理的内存分配进行优化和修改。

## 僵尸对象(Zombies)

1. 僵尸对象指的是对应的内存已经被释放并且不再会使用到，但是你的程序却在某处依然有指向它的引用。
2. 在 iOS 中有一个`NSZombie`机制，这个是为了内存调试的目的而设计的一种机制。在这个机制下，当你`NSZombieEnabled`为 YES 时，当一个对应的引用计数减为 0 时，这个对象不会被释放，当这个对象再收到任何消息时，它会记录一条warning，而不是直接崩溃，以方便我们进行程序调试。

## 坏内存访问监控手段

### 线下监控手段

1. Zombie 和 Address Sanitizer：僵尸对象和地址内存错误检测，可以在绝大多数情况下定位 EXC_BAD_ACCESS 问题代码，EXC_BAD_ACCESS 主要原因是访问了某些已经释放的对象，或者访问了它们已经释放的成员变量或方法。
2. Instruments-Zombies：测量一般内存使用情况，同时关注过度释放的Zombies对象检测。还按类提供对象分配的统计信息，以及所有活动分配的内存地址历史记录。
3. 注意：坏内存访问，EXC_BAD_ACCESS 错误，主要是访问了某些已经释放的对象，或者访问了它们已经释放的成员变量或方法。
4. EXC_BAD_ACCESS，坏内存访问线上监控手段等待验证。

## Zombie+Address Sanitizer

1.  Zombie 和 Address Sanitizer：僵尸对象和地址内存错误检测，可以在绝大多数情况下定位 EXC_BAD_ACCESS 问题代码，EXC_BAD_ACCESS 主要原因是访问了某些已经释放的对象，或者访问了它们已经释放的成员变量或方法。

## Instruments-Zombies

1. Instruments-Zombies：测量一般内存使用情况，同时关注过度释放的Zombies对象检测。还按类提供对象分配的统计信息，以及所有活动分配的内存地址历史记录。